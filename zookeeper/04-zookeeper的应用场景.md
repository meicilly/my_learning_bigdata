#### 数据发布/订阅
###### 数据发布/订阅(Publish/Subscribe)系统，就是配置中心。也就是发布者将数据发布到Zookeeper的一个或一系列节点上，供订阅者进行数据订阅，达到可以动态获取数据的目的，实现配置信息的集中式管理和数据的动态更新。
###### 发布/订阅系统一般有两种设计模式，分别是推(Push)模式和拉(Pull)模式。在推模式中，服务端主动将数据更新发送给所有订阅的客户端；而拉模式则是由客户端主动发起请求来获取最新数据，通常是客户端定时进行轮询拉取的方式。
###### Zookeeper采用的是推拉相结合的方式:客户端向服务端注册自己需要关注的节点，一但该节点的数据发生了变化，那么服务端就会向相应的客户端发送Watcher事件通知，从而达到实时获取最新配置信息的目的。
###### 如果将配置存放到Zookeeper上进行集中管理，那么在启动的时候会主动到Zookeeper客户端上进行一次配置信息的获取，同时指定节点上注册一个Watcher监听，这样一但配置信息发生了变化，服务端都会实时通知到所有订阅的客户端，从而达到更新配置信息的目的。
#### 命名服务
###### 命名服务是分布式系统中比较常见的一类场景。
#### 分布式锁
###### 分布式锁是控制分布式系统之间同步访问共享资源的一种方式。如果不痛系统或是同一个系统的不同主机之间共享了一个或一组资源，那么访问这些资源的时候，往往需要通过一些互斥手段来防止彼此之间的干扰，以保持一致性，在这种情况下，就需要使用分布式锁了。
##### 排他锁
###### 排他锁(Exclusive Locks,简称X锁)，又称为写锁或独占锁，是一种基本的锁类型。例如事务T1对数据对象O1加上了排他锁，那么整个加锁期间，只允许事务T1对O1进行读取和更新操作，其他任何事务都不能再对这个数据对象进行任何类型的操作--直到T1释放了排他锁。
##### 共享锁
###### 共享锁(Shared Locks,简称S锁)，又称为读锁，同样是一种基本的锁类型。如果事务T1对数据对象O1加上了共享锁，那么当前事务只能对O1进行读取操作，其他事务也只能对这个数据对象加共享锁--直到该数据对象上的所有共享锁都被释放了。
###### 共享锁和排他锁最根本的区别在于，加上排他锁后，数据对象只对一个事务可见，而加上共享锁后，数据对所有事务都可见。
#### ZAB协议
###### ZAB协议(Zookeeper原子消息广播协议)，是一种特别为zookeeper专门设计的一种支持崩溃恢复的原子广播协议。在zookeeper中，主要就是依赖ZAB协议来实现分布式数据的一致性，基于ZAB协议，Zookeeper实现了一种主备模式的系统架构来保持集群中各个副本之间数据的一致性，表现的形式就是使用一个单一的主进程来接收并处理客户端的所有事务请求，并采用ZAB协议，将服务器数据的状态变更以事务Proposal的形式广播到所有的副本进程中。
##### ZAB核心
###### 所有事务请求必须由一个全局唯一的服务器来协调处理，这样的服务器被称为Leader服务器，余下的服务器称为Follower服务器，Leader服务器负责将一个客户端事务请求转化成一个事务Proposal(提议)，并将该Proposal分发给集群中所有的Follower服务器,之后Leader服务器需要等待所有Follower服务器的反馈，一旦超过半数的Follower服务器进行了正确的反馈后，那么Leader就会再次向所有的Follower服务器分发Commit消息，要求其将前一个Proposal进行提交。
##### ZAB协议介绍
###### ZAB分为两种基本的模式:崩溃恢复和消息广播
###### *进入崩溃恢复模式*
###### 当整个服务框架启动过程中，或者Leader服务器出现网络中断、崩溃退出或重启等异常情况时，ZAB协议就会进入崩溃恢复模式，同时会选举产生新的Leader服务器。当选举产生新的Leader服务器，同时集群中已经有过半的机器与该Leader服务器完成状态同步后，ZAB协议就会退出恢复模式，状态同步也就是指数据同步，用来保证集群中过半的机器能够和Leader服务器的数据状态保持一致。
###### *进入消息广播模式*
###### 当集群中已经有过半的Follower服务器完成了和Leader服务器的状态同步，那么整个服务框架就可以进入消息广播模式，当一台同样遵守ZAB的服务器启动后假日到集群中，如果此时集群中已经存在一个Leader服务器在负责进行消息广播，那么加入的服务器会自觉地进入数据恢复模式:找到Leader所在的服务器，并预期进行数据同步，然后一起参与到消息广播流程中去。Zookeeper只允许唯一的一个Leader服务器来进行事务请求的处理，Leader服务器在接收到客户端的事务请求后，会生成对应的事务提议并发起一轮广播协议，而如果集群中的其他机器收到客户端的事务请求后，会把这些非Leader服务器会首先将这个事务请求转发给Leader服务器。
##### ZAB与Paxos的联系和区别
###### 联系:
- 都存在一个类似于Leader进程的角色，由其负责协调多个Follower进程的运行。
- Leader进程都会等待超过半数的Follower做出正确的反馈后，才会将一个提议进行提交。
- 在ZAB协议中，每个Proposal中都包含一个epoch值,用来代表当前的Leader周期，在Paxos算法中，同样存在这样的一个标识，名字为Ballot。
###### 区别:
- Paxos算法中，新选举产生的主进程会进行两个阶段的工作，第一阶段为读阶段，新的主进程和其他进程通信来收集主进程提出的提议，并将他们提交。第二阶段为写阶段，当前主进程开始提出自己的提议。
- ZAB协议在Paxos基础上添加了同步阶段，此时，新的Leader会确保存在过半的Follower已经提交了之前的Leader周期中的所有事务Proposal。这一同步阶段引入，能够有效的保证Leader在新的周期中提出事务Proposal事务，所有的进程都已经完成了对之前所有事务Proposal的提交。